<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/tokyo-night-dark.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Fira+Code:wght@400;600&display=swap">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@latest/dist/tailwind.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <script src="./js/highlight.min.js"></script>
    <script type="module">
        import { loadBuildDotC, loadChangelog, loadLicense, loadSecurity } from './js/get_remote_content.js';
        
        async function downloadRemote(url, filename) {
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error('Network response was not ok');
                const blob = await res.blob();
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename || '';
                document.body.appendChild(link);
                link.click();
                URL.revokeObjectURL(link.href);
                document.body.removeChild(link);
            } catch (err) {
                console.error('Download failed, opening in new tab', err);
                window.open(url, '_blank');
            }
        }

        const loaders = {
            build_dot_c: loadBuildDotC,
            changelog_content: loadChangelog,
            license_content: loadLicense,
            security_content: loadSecurity
        };

        const loaded = new Set();
        
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('[data-tab-content]');
            const buttons = document.querySelectorAll('[data-tab-button]');
            
            tabs.forEach(tab => tab.style.display = 'none');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const target = document.getElementById(tabName);
            if (!target) return;
            target.style.display = 'block';
            const btn = document.querySelector(`[data-tab-button="${tabName}"]`);
            if (btn) btn.classList.add('active');

            if (!loaded.has(tabName) && loaders[tabName]) {
                loaders[tabName]().then(() => loaded.add(tabName)).catch(err => console.error(err));
            }
        }
        
        window.downloadRemote = downloadRemote;
        window.switchTab = switchTab;
        loadBuildDotC().then(() => loaded.add('build_dot_c')).catch(() => {});
        loadChangelog().then(() => loaded.add('changelog_content')).catch(() => {});
        loadLicense().then(() => loaded.add('license_content')).catch(() => {});
        loadSecurity().then(() => loaded.add('security_content')).catch(() => {});
    </script>
    <title>Build Dot C</title>
</head>

<body>

    <div class="container">
        <div class="title-card">
            <div>
                <h1>Build.c</h1>
                <p class="tooltip">A tiny single-file build script for C/C++ projects â€” view or download the source below.</p>
            </div>
            <div class="controls">
                <div class="button_box">
                    <button type="button" class="download-btn" aria-label="Download build.c" onclick="downloadRemote('https://raw.githubusercontent.com/MitchNine/build_dot_c/refs/heads/master/build.c','build.c')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <path d="M12 15V3"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button data-tab-button="build_dot_c" class="tab-button active" onclick="switchTab('build_dot_c')">build.c</button>
            <button data-tab-button="changelog_content" class="tab-button" onclick="switchTab('changelog_content')">CHANGELOG.md</button>
            <button data-tab-button="license_content" class="tab-button" onclick="switchTab('license_content')">LICENSE.md</button>
            <button data-tab-button="security_content" class="tab-button" onclick="switchTab('security_content')">SECURITY.md</button>
        </div>
        
        <div class="code_block" id="build_dot_c" data-tab-content>
        </div>
        
        <div class="markdown_block" id="changelog_content" data-tab-content style="display:none;">
        </div>
        
        <div class="markdown_block" id="license_content" data-tab-content style="display:none;">
        </div>
        
        <div class="markdown_block" id="security_content" data-tab-content style="display:none;">
        </div>
    </div>

</body>

</html>
